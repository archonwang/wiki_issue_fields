<%= form_tag({}) do -%>
<%= hidden_field_tag 'back_url', url_for(params), :id => nil %>
<div class="autoscroll">
<table style="border-collapse:separate; border-spacing:0px; empty-cells:hide; border: hidden;">

  <% previous_group = false %>
  <tbody>
  <% issue_list(issues) do |issue, level| -%>
          <% if @query.grouped? && (group = @query.group_by_column.value(issue)) != previous_group %>
            <% reset_cycle %>
            <tr class="group open">
              <td colspan="<%= query.inline_columns.size + 2 %>">

                <%= group.blank? ? l(:label_none) : column_content(@query.group_by_column, issue) %> <span class="count"><%= @issue_count_by_group[group] %></span>
                <%= link_to_function("#{l(:button_collapse_all)}/#{l(:button_expand_all)}",
                                     "toggleAllRowGroups(this)", :class => 'toggle-all') %>
              </td>
            </tr>
            <% previous_group = group %>
          <% end %>
          <tr id="issue-<%= issue.id %>" class="hascontextmenu <%= cycle('odd', 'even') %> <%= issue.css_classes %> <%= level > 0 ? "idnt idnt-#{level}" : nil %>">
            <%= raw query.inline_columns.map {|column| "<td class=\"#{column.css_classes}\">#{column_content(column, issue)}</td>"}.join %>
          </tr>
          <% @query.block_columns.each do |column|
               if (text = column_content(column, issue)) && text.present? -%>
                          <tr background: none;>
                            <td colspan="<%= @query.inline_columns.size + 1 %>" class="<%= column.css_classes %>"><%= text %><br /><br /></td>
                          </tr>
                          <tr>
                            <td colspan="<%= @query.inline_columns.size + 1 %>"  ></td>
                          </tr>
                <% end -%>
          <% end -%>
  <% end -%>
  </tbody>
</table>
</div>
<% end -%>

